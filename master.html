<!DOCTYPE html>
<html lang="es" style="--accent: #8A2BE2; --accent-light: #8A2BE2; --ok: #10B981; --bad: #EF4444;"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8">

<title>ChinMaker ‚Ä¢ Editor Unificado v5 (flip animado)</title>
<meta name="viewport" content="width=device-width,initial-scale=1">
<style>
/* --- CSS EXISTENTE --- */
</style>
</head>
<body>
<div class="wrap">
  <header>
    <div class="title-block">
      <h1>ChinMaker ¬∑ Editor Unificado v5</h1>
      <small>Flip animado en editor y vista previa. Utilidad arriba, billeteras al medio, promo + revin abajo.</small>
    </div>
    <div class="row">
      <div class="chip" data-tooltip="Estado del perfil actual: se guarda autom√°ticamente üìÅ"><span style="font-size:16px">üìÅ</span> <span id="chipStatus" style="margin-left:6px">Perfil guardado</span></div>
    </div>
  </header>

  <div class="layout">
    <div class="card">
      <h2>Mensajes de revinculaci√≥n por PC</h2>
      <div id="saludosList" class="list">
        <!-- Render din√°mico de mensajes -->
      </div>
    </div>
  </div>
</div>

<script>
/* === Script actualizado === */
const STORAGE_LIST_KEY = 'chinmaker_profiles_list_v5';
const STORAGE_PREFIX = 'chinmaker_profile_v5_';
const STORAGE_LAST = 'chinmaker_last_profile_v5';

function renderSaludosEditor(){
  const list = document.getElementById('saludosList');
  list.innerHTML = '';

  config.whatsapp.pcs.forEach((pc, pcIndex) => {
    pc.mensajes.forEach((msg, msgIndex) => {
      const row = document.createElement('div');
      row.className = 'card-row';

      row.innerHTML = `
        <div class="grip">üîí</div>
        <div>
          <div class="wallet-header">
            <span class="wallet-label">Mensaje</span>

            <div class="wallet-actions">
              <select class="pc-selector" data-msg="${msg.id}">
                ${config.whatsapp.pcs.map((p, i) => `
                  <option value="${i}" ${i === pcIndex ? 'selected' : ''}>
                    ${p.nombre}
                  </option>
                `).join('')}
              </select>

              <button class="btn small subtle" data-remove="${msg.id}">
                Eliminar
              </button>
            </div>
          </div>

          <label>Us√° {usuario}</label>
          <textarea data-msg-text="${msg.id}">${msg.texto}</textarea>
        </div>
      `;

      list.appendChild(row);
    });
  });
}

document.addEventListener('change', e => {
  const sel = e.target.closest('.pc-selector');
  if (!sel) return;

  const msgId = sel.dataset.msg;
  const newPcIndex = Number(sel.value);

  let foundMsg = null;
  config.whatsapp.pcs.forEach((pc, i) => {
    const idx = pc.mensajes.findIndex(m => m.id === msgId);
    if (idx !== -1) {
      foundMsg = pc.mensajes.splice(idx, 1)[0];
    }
  });

  if (foundMsg) {
    config.whatsapp.pcs[newPcIndex].mensajes.push(foundMsg);
    markDirty();
    renderSaludosEditor();
    renderPreview();
  }
});

document.addEventListener('click', e => {
  const btn = e.target.closest('[data-remove]');
  if (!btn) return;

  const msgId = btn.dataset.remove;
  config.whatsapp.pcs.forEach(pc => {
    pc.mensajes = pc.mensajes.filter(m => m.id !== msgId);
  });

  markDirty();
  renderSaludosEditor();
  renderPreview();
});
</script>
</body>
</html>