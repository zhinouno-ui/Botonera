<!doctype html>
<html lang="es">
<head>
<meta charset="utf-8"/>
<meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>ChinDife</title>
<style>
  :root{
    --bg:#071227; --card:#0b1722; --muted:#9fb6c7; --accent:#06b6d4; --ok:#2ecc71; --bad:#e04747; --warn:#ffbf3c;
    --glass: rgba(255,255,255,0.03);
    --text:#e6f7fb;
    --border-color: rgba(255,255,255,0.08);
  }
  *{box-sizing:border-box}
  body{margin:0;min-height:100vh;font-family:Inter,Segoe UI,Roboto,Arial;background:linear-gradient(180deg,#071020,#071827);color:var(--text);padding:18px;}
  .wrap{max-width:1200px;margin:0 auto}
  h1{margin:0 0 8px 0;font-size:20px}
  .card{background:linear-gradient(180deg,var(--card), rgba(255,255,255,0.02));padding:12px;border-radius:10px;border:1px solid var(--border-color);box-shadow:0 6px 20px rgba(0,0,0,0.5)}
  .row{display:flex;gap:12px;align-items:flex-start;flex-wrap:wrap}
  label{font-size:13px;color:var(--muted);display:block;margin-bottom:6px}
  input[type=file]{background:var(--glass);padding:8px;border-radius:8px;border:1px dashed var(--border-color);color:var(--muted);width:100%;}
  textarea{width:100%;min-height:140px;background:var(--glass);border-radius:8px;padding:10px;border:1px solid var(--border-color);color:var(--text);resize:vertical}
  .controls{display:flex;gap:8px;align-items:center}
  .btn{background:linear-gradient(90deg,var(--accent),#3dd9f0);color:#042a31;border:none;padding:10px 12px;border-radius:8px;font-weight:700;cursor:pointer;transition:transform 0.1s ease-out}
  .btn:active{transform:translateY(1px)}
  .small{padding:8px 10px;font-size:13px}
  .filters{display:flex;gap:8px;align-items:center;flex-wrap:wrap;margin-top:10px;padding-top:10px;border-top:1px solid var(--border-color)}
  select{background:var(--glass);border-radius:8px;padding:8px;border:1px solid var(--border-color);color:var(--text);-webkit-appearance: none; -moz-appearance: none; appearance: none; background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 24 24' fill='%239fb6c7'%3E%3Cpath d='M7 10l5 5 5-5z'/%3E%3C/svg%3E"); background-repeat: no-repeat; background-position: right 8px center; background-size: 20px;}
  .summary{display:grid;grid-template-columns:repeat(auto-fit,minmax(180px,1fr));gap:12px;margin-top:12px;color:var(--muted);font-size:14px;padding-top:10px;border-top:1px solid var(--border-color)}
  .summary .badge {text-align:center; padding:10px; background:var(--glass); border-radius:8px; border:1px solid var(--border-color); display:flex; flex-direction:column; align-items:center; justify-content:center;}
  .summary .badge strong {font-size:1.4em; color:var(--text); margin-top:5px;}
  .summary .badge.diff strong {color:var(--bad);}
  .summary .badge.ok strong {color:var(--ok);}
  .summary .badge.warn strong {color:var(--warn);}
  .summary .badge.bad strong {color: var(--bad);}


  .table-wrap{margin-top:12px;max-height:520px;overflow:auto;border-radius:8px;background:rgba(255,255,255,0.01);border:1px solid var(--border-color)}
  table{width:100%;border-collapse:collapse;font-size:13px}
  th,td{padding:8px 10px;border-bottom:1px solid var(--border-color);text-align:left;vertical-align:middle}
  th{position:sticky;top:0;background:rgba(0,0,0,0.3);z-index:3;color:#dff6fb;font-weight:600}
  tr.ok td{background:rgba(46,204,113,0.04);border-left:2px solid var(--ok);}
  tr.miss-chunior td{background:rgba(224,71,71,0.04);border-left:2px solid var(--bad);}
  tr.miss-agente td{background:rgba(255,190,60,0.04);border-left:2px solid var(--warn);}
  .badge{padding:6px 8px;border-radius:8px;background:var(--glass);color:var(--muted);font-size:12px;}
  .state-ok{color:var(--ok);font-weight:700}
  .state-bad{color:var(--bad);font-weight:800}
  .state-warn{color:var(--warn);font-weight:800}
  .controls-vertical{display:flex;flex-direction:column;gap:8px}
  .notes{margin-top:10px;color:var(--muted);font-size:13px}
  .flex-col {display:flex; flex-direction:column; gap:4px;}
  .user-missing-indicator {
    color: var(--warn);
    cursor: help;
    font-weight: bold;
    margin-left: 4px;
  }

  @media (max-width:920px){ 
    .row{flex-direction:column} 
    .filters{flex-direction:column;align-items:stretch} 
    .summary{grid-template-columns:1fr;}
  }
</style>
<script type="importmap">
{
  "imports": {
    "react": "https://aistudiocdn.com/react@^19.2.0",
    "react-dom/": "https://aistudiocdn.com/react-dom@^19.2.0/",
    "react/": "https://aistudiocdn.com/react@^19.2.0/"
  }
}
</script>
</head>
<body>
<div class="wrap">
  <h1>Comparador AGENTE ⇄ CHUNIOR - ChinDiferencia</h1>
  <div class="card">
    <div class="row">
      <div style="flex:1;min-width:280px">
        <label>Cargar CSV(s) AGENTE (puedes seleccionar varios)</label>
        <input id="agentFiles" type="file" accept=".csv" multiple />
        <div class="notes">Nombra los archivos (ej. `agente_chino.csv`) para identificar la fuente. Se detecta formato principal o sub-agente.</div>
      </div>

      <div style="flex:1;min-width:300px">
        <label>Pegar texto CHUNIOR (todo el día / turno, varias líneas)</label>
        <textarea id="chuniorText" placeholder="Pega aquí las líneas copiadas de Chunior..."></textarea>
        <div class="notes">Ejemplo: <code>7007867    10-11-2025 13:48:45    fyeivan    682 - LUNA    $ 3.000,00    clau3628</code></div>
      </div>

      <div style="width:220px">
        <label>Acciones</label>
        <div class="controls-vertical">
          <button id="processBtn" class="btn small">Procesar y emparejar</button>
          <button id="exportBtn" class="small btn" style="background:linear-gradient(90deg,#f59e0b,#f97316)">Exportar CSV</button>
          <button id="copyExcelBtn" class="small btn" style="background:linear-gradient(90deg,#06b6d4,#3dd9f0)">Copiar para Excel</button>
        </div>
      </div>
    </div>

    <div class="summary" id="summaryBox">
      <div class="badge">Total Agente: <strong id="sumAgentTotal">0.00</strong></div>
      <div class="badge">Total Chunior: <strong id="sumChuniorTotal">0.00</strong></div>
      <div class="badge diff">Diferencia Total: <strong id="sumDifference">0.00</strong></div>
      <div class="badge warn">Recargas Admin: <strong id="sumAdminTotal">0.00</strong></div>
      <div class="badge ok">Ingresos Agente: <strong id="sumAgentIncome">0.00</strong></div>
      <div class="badge ok">Ingresos Chunior: <strong id="sumChuniorIncome">0.00</strong></div>
      <div class="badge diff">Dif. Ingresos: <strong id="sumDiffIncome">0.00</strong></div>
      <div class="badge bad">Egresos Agente: <strong id="sumAgentOutcome">0.00</strong></div>
      <div class="badge bad">Egresos Chunior: <strong id="sumChuniorOutcome">0.00</strong></div>
      <div class="badge diff">Dif. Egresos: <strong id="sumDiffOutcome">0.00</strong></div>
    </div>


    <div class="filters">
      <div class="badge">Registros totales: <span id="countTotals">0</span></div>
      <div><label>Fecha</label><select id="filterFecha"><option value="__ALL">Todos los días</option></select></div>
      <div><label>Agente</label><select id="filterAgente"><option value="__ALL">Todos</option></select></div>
      <div><label>Operador</label><select id="filterOperador"><option value="__ALL">Todos</option></select></div>
      <div><label>Billetera</label><select id="filterBilletera"><option value="__ALL">Todas</option></select></div>
      <div><label>Turno</label><select id="filterTurno"><option value="__ALL">Todos</option><option value="TM">Mañana (06-14)</option><option value="TT">Tarde (14-22)</option><option value="TN">Noche (22-06)</option></select></div>
      <div><label>Estado</label><select id="filterEstado"><option value="__ALL">Todos</option><option value="OK">OK</option><option
